<!DOCTYPE html>
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->


<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <script src="lib/simpleRequire.js"></script>
        <script src="lib/config.js"></script>
        <script src="lib/jquery.min.js"></script>
        <script src="lib/facePrint.js"></script>
        <script src="lib/testHelper.js"></script>
        <script src="lib/draggable.js"></script>
        <!-- <script src="ut/lib/canteen.js"></script> -->
        <link rel="stylesheet" href="lib/reset.css" />
    </head>
    <body>
        <style>
        </style>


        <div id="main0"></div>
        <div id="main1"></div>
        <div id="main2"></div>
        <div id="main3"></div>


        <div id="main_validate_breaks_1"></div>
        <div id="main_validate_breaks_2"></div>
        <div id="main_validate_breaks_3"></div>
        <div id="main_validate_breaks_4"></div>

        <div id="main_break_style_1"></div>
        <div id="main_break_style_2"></div>
        <div id="main_break_style_3"></div>


        <script>
        require([
            'echarts'
        ], function (echarts) {
            var option;
            var initialAxisBreaks = [{
                start: 123,
                end: 2012,
                gap: 10
            }, {
                start: 2305,
                end: 7400,
                gap: 0
            }];

            option = {
                xAxis: {
                    data: ['a', 'b', 'c', 'd', 'e'],
                    axisTick: {
                        show: false
                    }
                },
                yAxis: {
                    triggerEvent: true,
                    axisTick: {
                        show: true
                    },
                    minorTick: {
                        show: true
                    },
                    axisLabel: {
                        formatter: (val, val2, val3, val4) => {
                            return val;
                        }
                    },
                    breaks: initialAxisBreaks
                },
                legend: {
                    data: ['s2', 's3', 's4']
                },
                tooltip: {
                },
                series: [{
                    type: 'bar',
                    name: 's2',
                    data: [12, 88, 650, 1200, 7435],
                    label: {
                        show: true,
                        position: 'top'
                    }
                }, {
                    type: 'line',
                    name: 's3',
                    data: [12, 88, 650, 1200, 7435]
                }, {
                    type: 'scatter',
                    name: 's4',
                    data: [12, 88, 650, 1200, 7435],
                    symbolSize: 30
                }]
            };

            var chart = testHelper.create(echarts, 'main0', {
                title: [
                    'yAxis with breaks'
                ],
                option: option,
                buttons: [{
                    text: 'Revert Break Axis',
                    onclick: function (event) {
                        chart.dispatchAction({
                            type: 'updateAxisBreak',
                            yAxisIndex: 'all',
                            breaks: initialAxisBreaks
                        });
                    }
                }, {
                    text: 'Expand Break Axis ' + initialAxisBreaks[0].start + '~' + initialAxisBreaks[0].end,
                    onclick: function (event) {
                        chart.dispatchAction({
                            type: 'updateAxisBreak',
                            yAxisIndex: 'all',
                            breaks: [{
                                start: initialAxisBreaks[0].start,
                                end: initialAxisBreaks[0].end,
                                isExpanded: true,
                            }]
                        });
                    }
                }]
            });

            if (chart) {
                chart.on('axisBreakUpdated', function (params) {
                    console.log('axisBreakUpdated', params);
                    if (!params.breaks || params.breaks.length !== 1) {
                        throw new Error('test failed');
                    }
                    if (
                        !(params.breaks[0].start === initialAxisBreaks[0].start
                            && params.breaks[0].end === initialAxisBreaks[0].end
                        )
                        && !(params.breaks[0].start === initialAxisBreaks[1].start
                            && params.breaks[0].end === initialAxisBreaks[1].end
                        )
                    ) {
                        throw new Error('test failed');
                    }
                    if (params.breaks[0].isExpanded !== true
                        && params.breaks[0].isExpanded !== false
                    ) {
                        throw new Error('test failed');
                    }
                    if (params.yAxisIndex !== 0) {
                        throw new Error('test failed');
                    }
                });
            }
        });
        </script>


        <script>
        require([
            'echarts'
        ], function (echarts) {
            var option;

            option = {
                animation: 0,
                yAxis: {
                    data: ['a', 'b', 'c', 'd', 'e'],
                    axisTick: {
                        show: false
                    }
                },
                xAxis: {
                    triggerEvent: true,
                    axisTick: {
                        show: true
                    },
                    breaks: [{
                        start: 100,
                        end: 2300,
                        gap: 10
                    }, {
                        start: 2400,
                        end: 7400,
                        gap: 0
                    }]
                },
                legend: {
                    data: ['s2', 's3', 's4']
                },
                tooltop: {
                },
                series: [{
                    name: 's2',
                    type: 'bar',
                    data: [12, 88, 650, 1200, 7435],
                    label: {
                        show: true,
                        position: 'top'
                    }
                }, {
                    name: 's3',
                    type: 'line',
                    data: [12, 88, 650, 1200, 7435]
                }, {
                    name: 's4',
                    type: 'scatter',
                    data: [12, 88, 650, 1200, 7435],
                    symbolSize: 30
                }]
            };

            var chart = testHelper.create(echarts, 'main1', {
                title: [
                    'xAxis with breaks',
                ],
                option: option
            });
        });
        </script>



        <script>
            require([
                'echarts'
            ], function (echarts) {
                let option;

                const xData = ['a', 'b', 'c', 'd', 'e', 'f', 'g'];
                const xAxis = {
                    data: xData,
                    axisTick: {
                    },
                    breaks: [{
                        start: 1,
                        end: 2,
                        gap: 0.2
                    }, {
                        start: 4,
                        end: 6,
                        gap: 0
                    }],
                    axisLabel: {
                    }
                };

                option = {
                    title: [{
                        text: 'xAxis.boundaryGap: true',
                        left: '25%',
                        textAlign: 'center'
                    }, {
                        text: 'xAxis.boundaryGap: false',
                        left: '75%',
                        textAlign: 'center'
                    }],
                    animation: 0,
                    grid: [{
                        left: 100,
                        right: '55%'
                    }, {
                        right: 150,
                        left: '55%'
                    }],
                    xAxis: [{
                        gridIndex: 0,
                        boundaryGap: true,
                        ...xAxis
                    }, {
                        gridIndex: 1,
                        boundaryGap: false,
                        ...xAxis
                    }],
                    yAxis: [{
                        gridIndex: 0
                    }, {
                        gridIndex: 1
                    }],
                    series: [{
                        type: 'bar',
                        data: [12, 88, 65, 120, 200, 40, 75],
                        label: {
                            show: true,
                            position: 'top'
                        },
                        xAxisIndex: 0,
                        yAxisIndex: 0
                    }, {
                        type: 'line',
                        data: [12, 88, 65, 120, 200, 40, 75],
                        xAxisIndex: 0,
                        yAxisIndex: 0
                    }, {
                        type: 'scatter',
                        data: [12, 88, 65, 120, 200, 40, 75],
                        symbolSize: 30,
                        xAxisIndex: 0,
                        yAxisIndex: 0
                    }, {
                        type: 'bar',
                        data: [12, 88, 65, 120, 200, 40, 75],
                        label: {
                            show: true,
                            position: 'top'
                        },
                        xAxisIndex: 1,
                        yAxisIndex: 1
                    }, {
                        type: 'line',
                        data: [12, 88, 65, 120, 200, 40, 75],
                        xAxisIndex: 1,
                        yAxisIndex: 1
                    }, {
                        type: 'scatter',
                        data: [12, 88, 65, 120, 200, 40, 75],
                        symbolSize: 30,
                        xAxisIndex: 1,
                        yAxisIndex: 1
                    }]
                };

                var chart = testHelper.create(echarts, 'main2', {
                    title: [
                        'Category break axis',
                        'Break axis is not supported.'
                    ],
                    option: option
                });
            });
        </script>


        <script>
            require([
                'echarts'
            ], function (echarts) {
                let option;

                const data = [];
                const date = new Date('2024-04-09 9:30:00');
                const endTime = new Date('2024-04-09 15:00:00').getTime();
                const breakStart = new Date('2024-04-09 11:30:00');
                const breakEnd = new Date('2024-04-09 13:00:00');
                for (let val = 1669; date.getTime() <= endTime; ) {
                    if (date <= breakStart || date >= breakEnd) {
                        val = val + Math.floor((Math.random() - 0.5 * Math.sin(val / 1000)) * 20 * 100) / 100;
                        data.push([date.getTime(), val]);
                    }
                    date.setMinutes(date.getMinutes() + 1);
                }

                option = {
                    tooltip: {
                        show: true,
                        trigger: 'axis',
                    },
                    xAxis: [{
                        type: 'time',
                        interval: 1000 * 60 * 30, // 30 minutes
                        axisLabel: {
                            showMinLabel: true,
                            showMaxLabel: true,
                            formatter: (value, index, extra) => {
                                var format = echarts.time.format;
                                if (!extra || !extra.break) {
                                    return `${format(value, '{HH}:{mm}')}`;
                                }
                                if (extra.break.type === 'start') {
                                    return `${format(extra.break.start, '{HH}:{mm}')}/${format(extra.break.end, '{HH}:{mm}')}`;
                                }
                                return '';
                            },
                        },
                        breaks: [{
                            start: breakStart,
                            end: breakEnd,
                            gap: 0
                        }],
                        breakArea: {
                            zigzagAmplitude: 0
                        },
                        breakLabelLayout: {
                            moveOverlap: false
                        },
                    }],
                    yAxis: {
                        type: 'value',
                        min: 'dataMin',
                        axisLabel: {
                            formatter: n => n.toFixed(2)
                        }
                    },
                    series: [{
                        type: 'line',
                        data: data,
                        symbolSize: 0
                    }]
                };

                var chart = testHelper.create(echarts, 'main3', {
                    title: [
                        'Intraday stock chart'
                    ],
                    option: option,
                    buttons: [{
                        text: 'reset breaks',
                        onclick: function () {
                            chart.dispatchAction({
                                type: 'updateAxisBreak',
                                xAxisIndex: 'all',
                                breaks: [{
                                    start: breakStart,
                                    end: breakEnd,
                                }]
                            });
                        }
                    }]
                });
            });
        </script>




        <script>
        require([
            'echarts'
        ], function (echarts) {
            var option = {
                tooltip: {
                },
                xAxis: {
                    data: ['a', 'b', 'c', 'd', 'e', 'f', 'g'],
                },
                yAxis: {
                    breaks: [{
                        start: 2301,
                        // end: -3300,
                        gap: 100
                    }, {
                        // start: 4301,
                        end: 5300,
                        gap: 100
                    }, {
                        start: 100,
                        end: 2300,
                        gap: 20
                    }],
                },
                legend: {
                    data: ['s2', 'b']
                },
                grid: {
                    top: 25,
                },
                tooltip: {
                    trigger: 'axis'
                },
                series: [{
                    type: 'bar',
                    name: 's2',
                    data: [-400, 6000, 88, 650, 1200, 435, 800],
                    label: {
                        show: true
                    }
                }]
            };

            var chart = testHelper.create(echarts, 'main_validate_breaks_1', {
                title: [
                    'Validate breaks input: miss start or end',
                    'Should only display start: 100, end: 2300, and console.error.',
                ],
                option: option,
                height: 200
            });
        });
        </script>


        <script>
        require([
            'echarts'
        ], function (echarts) {
            var option = {
                tooltip: {
                },
                xAxis: {
                    data: ['a', 'b', 'c', 'd', 'e', 'f', 'g'],
                },
                yAxis: {
                    breaks: [{
                        start: 301,
                        end: 3300,
                        gap: 100
                    }, {
                        start: 2300,
                        end: 100,
                        gap: 20
                    }],
                },
                legend: {
                    data: ['s2', 'b']
                },
                grid: {
                    top: 25,
                },
                tooltip: {
                    trigger: 'axis'
                },
                series: [{
                    type: 'bar',
                    name: 's2',
                    data: [-400, 6000, 88, 650, 1200, 435, 800],
                    label: {
                        show: true
                    }
                }]
            };

            var chart = testHelper.create(echarts, 'main_validate_breaks_2', {
                title: [
                    'Validate breaks input: break range overlap',
                    'Should only display start: 100, end: 2300, and console.error.',
                ],
                option: option,
                height: 200
            });
        });
        </script>


        <script>
        require([
            'echarts'
        ], function (echarts) {
            var option = {
                tooltip: {
                },
                xAxis: {
                    data: ['a', 'b', 'c', 'd', 'e', 'f', 'g'],
                },
                yAxis: {
                    breaks: [{
                        end: 2300,
                        start: 100,
                        gap: 20
                    }],
                },
                legend: {
                    data: ['s2']
                },
                grid: {
                    top: 25,
                },
                tooltip: {
                    trigger: 'axis'
                },
                series: [{
                    type: 'bar',
                    name: 's2',
                    data: [-400, 3600, 88, 650, 1200, 435, 800],
                    label: {
                        show: true
                    }
                }]
            };

            var chart = testHelper.create(echarts, 'main_validate_breaks_3', {
                title: [
                    'Validate breaks input: start(2300) > end(100)',
                    'Should only display start: 100, end: 2300.',
                ],
                option: option,
                height: 200
            });
        });
        </script>



        <script>
        require([
            'echarts'
        ], function (echarts) {
            var option = {
                tooltip: {
                },
                xAxis: {
                    data: ['a', 'b', 'c', 'd', 'e', 'f', 'g'],
                },
                yAxis: {
                    breaks: [{
                        end: 2345,
                        start: 2345,
                        gap: 100
                    }],
                },
                legend: {
                    data: ['s2']
                },
                grid: {
                    top: 25,
                },
                tooltip: {
                    trigger: 'axis'
                },
                series: [{
                    type: 'bar',
                    name: 's2',
                    data: [-400, 3600, 88, 650, 1200, 435, 800],
                    label: {
                        show: true
                    }
                }]
            };

            var chart = testHelper.create(echarts, 'main_validate_breaks_4', {
                title: [
                    'Validate breaks input: start(2345) === end(2345) and has gap(100)',
                    'Should treat it as gap(0) and only draw one zigzag line.',
                ],
                option: option,
                height: 200
            });
        });
        </script>


        <script>
        require([
            'echarts'
        ], function (echarts) {
            var option = {
                tooltip: {
                },
                xAxis: {
                    data: ['a', 'b'],
                },
                yAxis: {
                    breaks: [{
                        end: 1000,
                        start: 100,
                        gap: 50
                    }],
                    breakArea: {
                        zigzagAmplitude: 0
                    }
                },
                legend: {
                    data: ['s2', 's3']
                },
                grid: {
                    top: 25,
                    bottom: 25,
                },
                tooltip: {
                    trigger: 'axis'
                },
                series: [{
                    type: 'bar',
                    name: 's2',
                    data: [-100, 1200],
                    label: {
                        show: true
                    }
                }]
            };
            var chart = testHelper.create(echarts, 'main_break_style_1', {
                title: [
                    'zigzagAmplitude: 0',
                ],
                option: option,
                height: 200
            });
        });
        </script>



        <script>
        require([
            'echarts'
        ], function (echarts) {
            var option = {
                tooltip: {
                },
                xAxis: {
                    data: ['a', 'b'],
                },
                yAxis: {
                    breaks: [{
                        end: 1000,
                        start: 100,
                        gap: 50
                    }],
                    breakArea: {
                        zigzagMinSpan: 0,
                        zigzagMaxSpan: 0,
                    }
                },
                legend: {
                    data: ['s2', 's3']
                },
                grid: {
                    top: 25,
                    bottom: 25,
                },
                tooltip: {
                    trigger: 'axis'
                },
                series: [{
                    type: 'bar',
                    name: 's2',
                    data: [-100, 1200],
                    label: {
                        show: true
                    }
                }]
            };
            var chart = testHelper.create(echarts, 'main_break_style_2', {
                title: [
                    'zigzagMinSpan: 0, zigzagMaxSpan: 0',
                    'Should not dead loop',
                ],
                option: option,
                height: 200
            });
        });
        </script>



        <script>
        require([
            'echarts'
        ], function (echarts) {
            var option = {
                tooltip: {
                },
                xAxis: {
                    data: ['a', 'b'],
                },
                yAxis: {
                    breaks: [{
                        end: 1000,
                        start: 100,
                        gap: 50
                    }],
                    breakArea: {
                        itemStyle: {
                            opacity: 1,
                            borderType: 'solid',
                        }
                    }
                },
                legend: {
                    data: ['s2', 's3']
                },
                grid: {
                    top: 25,
                    bottom: 25,
                },
                tooltip: {
                    trigger: 'axis'
                },
                series: [{
                    type: 'bar',
                    name: 's2',
                    data: [-100, 1200],
                    label: {
                        show: true
                    }
                }]
            };
            var chart = testHelper.create(echarts, 'main_break_style_3', {
                title: [
                    'breakArea.itemStyle: {opacity: 1, borderType: "solid"}',
                    'Should not transparent',
                ],
                option: option,
                height: 200
            });
        });
        </script>





    </body>

</html>

